import{r as e,l as t,c as s,y as l,b as a,d as n,g as o,u as i,w as r,v as u,p as c,n as d,m as p,t as m,e as f,z as w,F as g,A as b,s as v,B as y,o as h,C as x,D as k}from"./index-CAknvfu8.js";import{_ as C}from"./alertModal-CN9ztud4.js";const P={key:0,class:"form-control mb-4"},V={key:0,class:"text-red-500 mt-2"},L={class:"flex flex-nowrap justify-between"},N=["disabled"],T={key:0},j={key:1,class:"loading loading-spinner"},_={key:2},q={key:1,class:"form-control mb-4"},U={class:"form-control mb-4"},S={key:0,class:"text-red-500"},I={class:"flex justify-between items-center text-sm text-gray-500 mb-4"},z={__name:"resetPw",props:{formLogin:{type:Object,required:!0}},emits:["goLogin","resetPw"],setup(v,{emit:y}){const h=y,x=e("登入"),k=e(!1),C=t({content:""}),z=t({email:"",verificationCode:"",isSendVerificationCode:!1,newPw:"",newPwCheck:""}),A=t({status:!1}),G=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,R=s((()=>G.test(z.email)));function Z(){b.forgetPwCodeCheck(z.email,z.verificationCode).then((e=>{console.log(e.data),A.status=!0})).catch((e=>{A.status=!1,C.content=e.response.data,k.value=!0,x.value="確認"}))}const M=e(!1);function O(){z.email?R.value?(console.log("發送驗證碼中..."),M.value=!0,b.forgetPwVerifyCode(z.email).then((e=>{console.log(e.data),M.value=!1,function(){if(F.value)return;F.value=!0,$=setInterval((()=>{E.value>0?E.value--:(clearInterval($),F.value=!1,E.value=60)}),1e3)}()})),z.isSendVerificationCode=!0):alert("請輸入有效的信箱地址"):alert("請輸入聯絡信箱")}function B(){"登入"===x.value?h("goLogin"):k.value=!1}function D(){z.newPw===z.newPwCheck?b.forgetPw({email:z.email,verifyCode:z.verificationCode,newPw:z.newPw}).then((e=>{C.content="重設密碼成功！",k.value=!0,x.value="登入"})).catch((e=>{C.content=e.response.data,k.value=!0})):alert("密碼不一致")}const E=e(60),F=e(!1);let $=null;return(e,t)=>{const s=l("router-link");return a(),n(g,null,[o("form",{class:"bg-white p-6 w-full lg:w-1/2",onSubmit:p(D,["prevent"])},[t[12]||(t[12]=o("h1",{class:"title-2"},"重新設定密碼",-1)),i(A).status?c("",!0):(a(),n("div",P,[t[5]||(t[5]=o("label",{class:"label",for:"email"},[o("span",{class:"label-text"},"信箱")],-1)),r(o("input",{id:"email",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i(z).email=e),placeholder:"請輸入信箱",class:"input input-bordered flex-grow",required:""},null,512),[[u,i(z).email]]),i(R)?c("",!0):(a(),n("div",V," 請輸入有效的信箱地址 ")),t[6]||(t[6]=o("label",{class:"label",for:"emailVerify"},[o("span",{class:"label-text"},[d("驗證碼"),o("span",{class:"text-red-500"},"*")])],-1)),o("div",L,[r(o("input",{id:"emailVerify",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i(z).verificationCode=e),placeholder:"輸入6位驗證碼",class:"input input-bordered w-full mr-3",required:""},null,512),[[u,i(z).verificationCode]]),i(z).isSendVerificationCode?(a(),n("button",{key:0,onClick:p(Z,["prevent"]),type:"button",class:"btn btn-primary w-1/4 mr-3"}," 驗證 ")):c("",!0),o("button",{onClick:p(O,["prevent"]),type:"button",class:"btn btn-primary w-auto",disabled:i(F)||i(M)},[i(F)?(a(),n("span",T,m(i(E))+" 秒後可重新傳送",1)):i(M)?(a(),n("span",j)):(a(),n("span",_,"取得驗證碼"))],8,N)])])),i(A).status?(a(),n("div",q,[t[8]||(t[8]=o("label",{class:"label",for:"newpassword"},[o("span",{class:"label-text"},[d("設定新密碼"),o("span",{class:"text-red-500"},"*")])],-1)),r(o("input",{id:"newpassword",type:"password","onUpdate:modelValue":t[2]||(t[2]=e=>i(z).newPw=e),placeholder:"***********",class:"input input-bordered w-full",required:""},null,512),[[u,i(z).newPw]]),t[9]||(t[9]=o("span",{class:"text-xs text-gray-500"},"請輸入12-30個字元，內容須包含英文大寫、英文小寫、數字及符號4種類型字元。",-1)),o("div",U,[t[7]||(t[7]=o("label",{class:"label",for:"newpasswordCheck"},[o("span",{class:"label-text"},[d("密碼確認"),o("span",{class:"text-red-500"},"*")])],-1)),r(o("input",{id:"newpasswordCheck",type:"password","onUpdate:modelValue":t[3]||(t[3]=e=>i(z).newPwCheck=e),placeholder:"再次輸入密碼",class:"input input-bordered w-full",required:""},null,512),[[u,i(z).newPwCheck]])]),i(z).newPw!=i(z).newPwCheck?(a(),n("div",S,"密碼不一致")):c("",!0),t[10]||(t[10]=o("button",{type:"submit",class:"btn btn-primary w-full mb-3"},"送出",-1))])):c("",!0),o("div",I,[o("a",{href:"#",onClick:p(B,["prevent"]),class:"hover:underline"},"返回登入"),f(s,{to:"/registration",class:"hover:underline"},{default:w((()=>t[11]||(t[11]=[d("註冊")]))),_:1})])],32),f(i(C),{isVisible:i(k),content:i(C).content,goToName:i(x),"onUpdate:visible":t[4]||(t[4]=e=>k.value=e),onGoTo:B},null,8,["isVisible","content","goToName"])],64)}}},A={class:"flex justify-between items-center text-sm text-gray-500"},G={__name:"login",props:{formLogin:{type:Object,required:!0}},emits:["goResetPw"],setup(s,{emit:c}){const m=v(),k=s,P=c,V=y("login");function L(){b.signIn({userName:k.formLogin.userName,password:k.formLogin.password}).then((e=>{let t=1e3*x(e.data).exp;localStorage.setItem("token",e.data),localStorage.setItem("token.expire",t),V(),m.push("/")})).catch((e=>{400===e.response.status?(j.content="帳號密碼錯誤，請重新輸入!\n提醒您，密碼錯誤達3次將鎖定帳號。\n您可使用「忘記密碼」重新設定密碼。",j.goToName="確認",T.value=!0):428===e.response.status?(j.content="您的密碼已超過90天未更改，為確保帳號安全，請立即更改您的密碼，謝謝。",j.goToName="修改密碼",T.value=!0):(j.goToName="確認",j.content=e.response.data,T.value=!0)}))}function N(){P("goResetPw")}h((()=>{}));const T=e(!1),j=t({content:"",goToName:""});function _(){"變更密碼"===j.goToName?N():m.push("/login")}return(e,t)=>{const c=l("router-link"),m=C;return a(),n(g,null,[o("form",{class:"p-6 w-full lg:w-1/2 space-y-4",onSubmit:p(L,["prevent"])},[t[4]||(t[4]=o("h1",{class:"title-2"},"登入系統",-1)),t[5]||(t[5]=o("label",{for:"email",class:"sr-only"},"Email",-1)),r(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.formLogin.userName=e),placeholder:"請輸入帳號",class:"input input-bordered w-full",required:""},null,512),[[u,s.formLogin.userName]]),t[6]||(t[6]=o("label",{for:"password",class:"sr-only"},"Password",-1)),r(o("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>s.formLogin.password=e),placeholder:"請輸入密碼",class:"input input-bordered w-full",required:""},null,512),[[u,s.formLogin.password]]),t[7]||(t[7]=o("button",{type:"submit",class:"btn btn-primary w-full text-lg font-bold"},"登入",-1)),o("div",A,[o("a",{href:"#",onClick:p(N,["prevent"]),class:"hover:underline text-lg"},"忘記密碼"),f(c,{to:"/registration",class:"hover:underline text-lg"},{default:w((()=>t[3]||(t[3]=[d("註冊")]))),_:1})])],32),f(m,{isVisible:i(T),content:i(j).content,goToName:i(j).goToName,"onUpdate:visible":t[2]||(t[2]=e=>T.value=e),onGoTo:_},null,8,["isVisible","content","goToName"])],64)}}},R={class:"flex items-center justify-center bg-white-100"},Z={class:"w-full lg:w-4/5 flex items-center justify-center"},M={__name:"index",setup(e){const s=t({status:"login",userName:"",password:""});function l(){console.log("忘記密碼"),s.status="resetPw"}function r(){console.log("返回登入"),s.status="login"}return(e,t)=>(a(),n("section",R,[o("div",Z,[t[0]||(t[0]=o("img",{class:"w-1/2 hidden lg:block",src:"/MyInterface/image/login.jpg",alt:"login"},null,-1)),"login"==i(s).status?(a(),k(G,{key:0,formLogin:i(s),onGoResetPw:l},null,8,["formLogin"])):c("",!0),"resetPw"==i(s).status?(a(),k(z,{key:1,formLogin:i(s),onGoLogin:r},null,8,["formLogin"])):c("",!0)])]))}};export{M as default};
